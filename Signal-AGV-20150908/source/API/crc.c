/****************************************************************************
* 名    称：CRC计算单元
* 功    能：
* 说    明：
* 作    者: 鲁斌
* 创建日期：2015-02-12
* 修改记录：
****************************************************************************/
#include "crc.h"

#define CRCHECK(crc,byte) (((crc) >> 8 ) ^ tabel[((crc) ^ (unsigned int) (byte)) & 0XFF]) 
const uint16_t tabel[256] = { 
                                0x3B78,0x7BBC,0x93D5,0x9BDE,0xA3E6,0xB3F7,0xC408,0xCC11,0xD419,0xDC22,0xE42A,
                                0x6577,0x8599,0x95AA,0x9DB2,0xA5BB,0xADC3,0xBDD4,0xC5DD,0xCDE5,0xD5EE,0xDDF6,
                                0x6F54,0x8F76,0x9F87,0xA78F,0xAF98,0xB7A0,0xBFA9,0xC7B1,0xCFBA,0xD7C2,0xE7D3,
                                0x37C3,0x4FDD,0x5FEE,0x67F6,0x7807,0x800F,0x8818,0x9020,0x9829,0xA031,0xA83A,
                                0xCA17,0xEA39,0xFA4A,0x0253,0x0A5C,0x1264,0x2275,0x2A7E,0x3286,0x3A8F,0x4297,
                                0x9D2B,0xB544,0xBD4D,0xCD5E,0xD566,0xDD6F,0xE577,0xED80,0xF588,0xFD91,0x059A,
                                0x2DC1,0x4DE3,0x65FC,0x760D,0x861E,0x8E27,0x9E38,0xAE48,0xB651,0xBE59,0xCE6A,
                                0x3DE3,0x761F,0x8630,0x8E38,0x9641,0x9E49,0xAE5A,0xB663,0xBE6B,0xCE7C,0xD684,
                                0x5C21,0x8C54,0xA46D,0xAC76,0xBC87,0xC48F,0xD4A0,0xDCA9,0xE4B1,0xECBA,0xF4C2,
                                0x4CE9,0x7514,0x8525,0x8D2D,0x9536,0xA547,0xAD4F,0xB558,0xC569,0xCD71,0xD57A,
                                0x3FD3,0x5FF5,0x7006,0x8017,0x881F,0x9028,0x9830,0xA039,0xA841,0xB04A,0xC05B,
                                0x2217,0x4238,0x4A41,0x5A52,0x625A,0x6A63,0x726B,0x7A74,0x827C,0x8A85,0x9A96,
                                0xB44D,0xDC77,0xEC88,0xFC99,0x04A3,0x14B4,0x1CBC,0x24C5,0x2CCD,0x34D6,0x44E7,
                                0x7C23,0x9C45,0xAC56,0xB45E,0xBC67,0xCC78,0xD480,0xDC89,0xE491,0xEC9A,0xF4A2,
                                0x0AAD,0x22C7,0x32D8,0x42E9,0x4AF1,0x52FA,0x5B02,0x630B,0x6B13,0x7B24,0x832D,
                                0xCAF5,0xE30F,0xFB28,0x0332,0x0B3A,0x1343,0x1B4B,0x2354,0x3365,0x3B6D,0x4376,
                                0xB2D4,0xD2F6,0xE307,0xF318,0xFB20,0x032A,0x0B32,0x133B,0x1B43,0x234C,0x2B54, 
                                0xD4A9,0xFCD3,0x0CE5,0x14EE,0x24FF,0x2D07,0x3510,0x3D18,0x4521,0x4D29,0x5532,
                                0x99F0,0xCA23,0xDA34,0xEA45,0xFA56,0x0260,0x0A68,0x1A79,0x2282,0x2A8A,0x3292,
                                0x8783,0xAFAE,0xBFBF,0xCFD0,0xD7D8,0xDFE1,0xE7E9,0xEFF2,0xF7FA,0x0004,0x080C,
                                0x9CAC,0xBCCE,0xCCDF,0xD4E7,0xE4F8,0xED01,0xF509,0xFD12,0x051B,0x0D24,0x152C,
                                0x4208,0x6A33,0x7A44,0x8A55,0x925D,0xB27F,0xBA87,0xC290,0xD2A1,0xDAA9,0xE2B2,
                                0xD54B,0x057F,0x1590,0x1D98,0x25A1,0x35B2,0x3DBA,0x45C3,0x4DCB,0x55D4,0x65E5,
                                0x358C,0x75D0,0x95F2
                            };

/****************************************************************************
*  名    称：unsigned short CalcCRC(uint8_t *data, uint32_t size,uint16_t pwd)
*  功    能：CRC16 校验算法
*  参    数：*data：要校验的数据地址，size：数据长度，建立连接时的密码(默认为 0x0000)
*  返    回：16 位的 CRC 校验值
****************************************************************************/
unsigned short CalcCRC(unsigned char *data, unsigned short size, unsigned short pwd)
{
	uint32_t i; 
	unsigned short crc = 0; 
	for (i = 0; i < size; i++) 
	{
		crc = CRCHECK(crc, data[i]);
	} 
	return crc^pwd;
}					

